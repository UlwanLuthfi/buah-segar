<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Histori Transaksi | Rayuan Manis</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="./src/plugins/fontawesome-free/css/all.min.css"
    />

    <!-- DataTables -->
    <link
      rel="stylesheet"
      href="./src/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css"
    />
    <link
      rel="stylesheet"
      href="./src/plugins/datatables-responsive/css/responsive.bootstrap4.min.css"
    />

    <!-- AdminLTE -->
    <link rel="stylesheet" href="./src/css/adminlte.min.css" />
    <link rel="stylesheet" href="./src/css/admin-custom.css" />

    <!-- Javascript -->
    <script src="../src/script/guard.js"></script>
  </head>

  <body class="hold-transition sidebar-mini">
    <div class="wrapper">
      <!-- Navbar -->
      <nav class="main-header navbar navbar-expand navbar-white navbar-light">
        <!-- LEFT -->
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" data-widget="pushmenu" href="#">
              <i class="fas fa-bars"></i>
            </a>
          </li>
        </ul>

        <!-- RIGHT -->
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <button
              onclick="logoutAdmin()"
              class="btn btn-danger btn-sm"
              style="margin-right: 10px"
            >
              <i class="fas fa-sign-out-alt"></i> Logout
            </button>
          </li>
        </ul>
      </nav>

      <!-- Sidebar -->
      <aside class="main-sidebar sidebar-dark-pink elevation-4">
        <a href="index.html" class="brand-link">
          <img
            src="./src/img/logo.png"
            class="brand-image"
            alt="Rayuan Manis Logo"
          />
          <span class="brand-text font-weight-light">Rayuan Manis</span>
        </a>

        <div class="sidebar">
          <nav>
            <ul class="nav nav-pills nav-sidebar flex-column">
              <li class="nav-item">
                <a href="index.html" class="nav-link">
                  <i class="nav-icon fas fa-chart-line"></i>
                  <p>Dashboard</p>
                </a>
              </li>

              <li class="nav-item">
                <a href="transactions.html" class="nav-link active">
                  <i class="nav-icon fas fa-receipt"></i>
                  <p>Transaksi</p>
                </a>
              </li>

              <li class="nav-item">
                <a href="users.html" class="nav-link">
                  <i class="nav-icon fas fa-users"></i>
                  <p>User</p>
                </a>
              </li>

              <li class="nav-item">
                <a href="products.html" class="nav-link">
                  <i class="nav-icon fas fa-apple-alt"></i>
                  <p>Produk</p>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </aside>

      <!-- Content Wrapper -->
      <div class="content-wrapper">
        <!-- Header -->
        <section class="content-header">
          <div class="container-fluid">
            <h1>Histori Transaksi</h1>
            <p class="text-muted">
              Daftar seluruh pemesanan hampers dan produk
            </p>
          </div>
        </section>

        <!-- Main content -->
        <section class="content">
          <div class="container-fluid">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">Data Transaksi</h3>
              </div>

              <div class="card-body table-responsive p-4">
                <table
                  id="transactionsTable"
                  class="table table-bordered table-striped"
                >
                  <thead>
                    <tr>
                      <th>ID Transaksi</th>
                      <th>Nama Pemesan</th>
                      <th>Paket</th>
                      <th>Tanggal</th>
                      <th>Status</th>
                      <th>Aksi</th>
                    </tr>
                  </thead>

                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <!-- Scripts -->
    <script src="./src/plugins/jquery/jquery.min.js"></script>
    <script src="./src/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="./src/js/adminlte.min.js"></script>

    <!-- DataTables -->
    <script src="./src/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="./src/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="./src/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="./src/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
    <script src="../src/script/auth.js"></script>

    <script>
      function getTransactions() {
        return JSON.parse(localStorage.getItem("transactions")) || [];
      }
    </script>

    <script>
      $(function () {
        const table = $("#transactionsTable").DataTable({
          responsive: true,
          autoWidth: false,
          order: [[3, "desc"]],
        });

        const transactions =
          JSON.parse(localStorage.getItem("transactions")) || [];

        transactions.forEach((trx) => {
          table.row.add([
            trx.id,
            trx.nama || "-",
            trx.package || "-",
            trx.date || "-",
            `<span class="badge badge-warning">Pending</span>`,
            `
          <button class="btn btn-sm btn-info" onclick="viewTransaction('${trx.id}')">
            <i class="fas fa-eye"></i>
          </button>
          <button class="btn btn-sm btn-danger" onclick="deleteTransaction('${trx.id}')">
            <i class="fas fa-trash"></i>
          </button>
        `,
          ]);
        });

        table.draw();
      });

      function deleteTransaction(id) {
        if (!confirm("Yakin hapus transaksi ini?")) return;

        let transactions =
          JSON.parse(localStorage.getItem("transactions")) || [];

        transactions = transactions.filter((t) => String(t.id) !== String(id));

        localStorage.setItem("transactions", JSON.stringify(transactions));
        location.reload();
      }

      function viewTransaction(id) {
        const trx = JSON.parse(localStorage.getItem("transactions"))?.find(
          (t) => String(t.id) === String(id)
        );

        if (!trx) return;

        alert(
          `
Nama: ${trx.nama}
Email: ${trx.email}
Paket: ${trx.package}
Buah: ${trx.fruits.join(", ")}
Alamat: ${trx.alamat}
Pesan: ${trx["teks-ucapan"]}
      `
        );
      }
    </script>
  </body>
</html>
